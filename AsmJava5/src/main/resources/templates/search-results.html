<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Kết quả tìm kiếm cho: ' + ${keyword} + ' - Social App'">Kết quả tìm kiếm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>

<body
    th:attr="data-homebg=${currentUser != null and currentUser.equippedHomeBg != null ? currentUser.equippedHomeBg : ''}">

    <div id="homeBgOverlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:0;pointer-events:none;"></div>

    <div class="page-wrapper">
        <!-- TOP NAVBAR -->
        <nav class="top-navbar">
            <a class="brand" th:href="@{/home}">✦ SocialApp</a>
            <div class="search-wrap d-none d-md-flex">
                <form th:action="@{/search}" method="get" class="w-100 position-relative">
                    <i class="bi bi-search"></i>
                    <input type="text" name="q" class="search-input"
                        placeholder="Tìm kiếm tác phẩm, tag, @người dùng..." th:value="${keyword}">
                </form>
            </div>
            <div class="nav-spacer"></div>
            <div class="d-flex align-items-center gap-2">
                <a th:href="@{/notifications}" th:if="${currentUser != null}" class="nav-icon text-decoration-none">
                    <i class="bi bi-bell"></i>
                    <span class="notif-badge">3</span>
                </a>
                <a th:href="@{/chat}" th:if="${currentUser != null}" class="nav-icon text-decoration-none">
                    <i class="bi bi-chat-dots"></i>
                    <span class="notif-badge">5</span>
                </a>
                <a th:href="@{/upload}" class="upload-btn text-decoration-none">
                    <i class="bi bi-cloud-upload"></i> Đăng tải
                </a>
                <a th:href="@{/profile}" th:if="${currentUser != null}" class="text-decoration-none">
                    <div class="avatar-nav" th:if="${currentUser.avatarData != null}"
                        style="overflow:hidden;padding:0;">
                        <img th:src="@{/profile/avatar/{id}(id=${currentUser.id})}"
                            style="width:100%;height:100%;border-radius:50%;object-fit:cover;" alt="avatar">
                    </div>
                    <div class="avatar-nav" th:if="${currentUser.avatarData == null}"
                        th:text="${currentUser.username.substring(0,1).toUpperCase()}">U</div>
                </a>
                <a th:href="@{/wallet/recharge}" th:if="${currentUser != null}" class="nav-icon text-decoration-none"
                    title="Nạp tiền">
                    <i class="bi bi-wallet2"></i>
                </a>
                <a th:href="@{/auth/logout}" th:if="${currentUser != null}" class="nav-icon text-decoration-none"
                    title="Đăng xuất">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
                <a th:href="@{/auth/login}" th:if="${currentUser == null}" class="nav-icon text-decoration-none"
                    title="Đăng nhập">
                    <i class="bi bi-box-arrow-in-right"></i> Đăng nhập
                </a>
            </div>
        </nav>

        <div class="page-layout mt-4">
            <!-- MAIN CONTENT -->
            <main class="main-content mx-auto" style="max-width: 1000px;">
                <h3 class="fw-bold mb-4" th:text="'Kết quả tìm kiếm cho: &quot;' + ${keyword} + '&quot;'">Kết quả tìm
                    kiếm</h3>

                <div th:if="${searchResults.size() == 0}">
                    <div class="alert alert-secondary text-center rounded-4 py-5"
                        style="background: var(--bg2); border: 1px dashed var(--border);">
                        <i class="bi bi-search fs-1 text-muted d-block mb-3"></i>
                        <h5>Không tìm thấy kết quả nào</h5>
                        <p class="text-muted">Rất tiếc, không bài viết nào phù hợp với tìm kiếm của bạn.<br>Hãy thử tìm
                            bằng từ khóa khác hoặc sửa lỗi chính tả.</p>
                        <a th:href="@{/home}" class="btn btn-outline-light rounded-pill mt-2">Quay lại Khám phá</a>
                    </div>
                </div>

                <!-- IMAGE GRID -->
                <div class="img-grid" th:if="${searchResults.size() > 0}">
                    <!-- Lặp qua các bài post lấy từ DB -->
                    <div class="img-card" th:each="post : ${searchResults}">
                        <a th:href="@{/post/{id}(id=${post.id})}" class="text-decoration-none">
                            <img th:if="${post.imageData != null}" th:src="@{/upload/image/{id}(id=${post.id})}"
                                alt="Art" class="img-thumb">
                            <img th:if="${post.imageData == null && post.imageUrl != null}" th:src="${post.imageUrl}"
                                alt="Art" class="img-thumb">
                            <div class="img-overlay">
                                <button class="overlay-btn saved"><i class="bi bi-bookmark-fill"></i></button>
                                <button class="overlay-btn liked"><i class="bi bi-heart-fill"></i> <span
                                        th:text="${post.likesCount}">0</span></button>
                            </div>
                        </a>
                        <div class="img-info">
                            <a th:href="@{/post/{id}(id=${post.id})}" class="text-decoration-none text-light">
                                <div class="img-title" th:text="${post.title}">Title</div>
                            </a>
                            <div class="img-meta">
                                <a th:href="@{/profile/view/{id}(id=${post.user.id})}"
                                    class="img-author text-decoration-none text-light">
                                    <img th:if="${post.user.avatarData != null}"
                                        th:src="@{/profile/avatar/{id}(id=${post.user.id})}" class="author-dot"
                                        style="object-fit:cover;" alt="A">
                                    <div th:if="${post.user.avatarData == null}"
                                        class="author-dot bg-primary text-white d-flex align-items-center justify-content-center"
                                        th:text="${post.user.username.substring(0,1).toUpperCase()}">V</div>
                                    <span class="ms-1" th:text="'@' + ${post.user.username}">@user</span>
                                </a>
                                <div class="img-stats"><i class="bi bi-eye"></i> <span th:text="${post.views}">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Background JS -->
    <script th:if="${currentUser != null and currentUser.equippedHomeBg != null}">
        document.addEventListener('DOMContentLoaded', () => {
            const bgUrl = document.body.getAttribute('data-homebg');
            if (bgUrl) {
                document.body.style.background = `url('${bgUrl}') no-repeat center center fixed`;
                document.body.style.backgroundSize = 'cover';
                document.getElementById('homeBgOverlay').style.display = 'block';
            }
        });
    </script>
</body>

</html>