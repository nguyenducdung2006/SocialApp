<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Xu H∆∞·ªõng (Trending) - Social App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>

<body
    th:attr="data-homebg=${sessionUser != null and sessionUser.equippedHomeBg != null ? sessionUser.equippedHomeBg : ''}">

    <div id="homeBgOverlay"
        style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:0;pointer-events:none;"></div>

    <div style="position:relative;z-index:1;">

        <nav class="top-navbar">
            <a class="brand" th:href="@{/home}">‚ú¶ SocialApp</a>
            <div class="search-wrap d-none d-md-flex">
                <form th:action="@{/search}" method="get" class="w-100 position-relative">
                    <i class="bi bi-search"></i>
                    <input type="text" name="q" class="search-input" placeholder="T√¨m ki·∫øm t√°c ph·∫©m, ng∆∞·ªùi d√πng...">
                </form>
            </div>
            <div class="nav-spacer"></div>
            <div class="d-flex align-items-center gap-2">
                <a th:href="@{/saved}" class="nav-icon text-decoration-none">
                    <i class="bi bi-bookmark-fill" style="font-size: 1.25rem;"></i>
                </a>
                <a th:href="@{/upload}" class="upload-btn text-decoration-none">
                    <i class="bi bi-cloud-upload"></i> ƒêƒÉng t·∫£i
                </a>
                <a th:href="@{/profile}" class="text-decoration-none">
                    <div class="avatar-nav" th:if="${sessionUser != null and sessionUser.avatarData != null}"
                        style="overflow:hidden;padding:0;">
                        <img th:src="@{/profile/avatar/{id}(id=${sessionUser.id})}"
                            style="width:100%;height:100%;border-radius:50%;object-fit:cover;" alt="avatar">
                    </div>
                    <div class="avatar-nav" th:if="${sessionUser == null or sessionUser.avatarData == null}"
                        th:text="${sessionUser != null ? sessionUser.username.substring(0,1).toUpperCase() : 'U'}">U
                    </div>
                </a>
                <a th:href="@{/auth/login}" th:if="${sessionUser == null}" class="nav-icon text-decoration-none"
                    title="ƒêƒÉng nh·∫≠p">
                    <i class="bi bi-box-arrow-in-right"></i>
                </a>
                <a th:href="@{/auth/logout}" th:if="${sessionUser != null}" class="nav-icon text-decoration-none"
                    title="ƒêƒÉng xu·∫•t">
                    <i class="bi bi-box-arrow-right"></i>
                </a>
            </div>
        </nav>

        <div class="tab-bar">
            <a th:href="@{/home}" class="tab-link">D√†nh cho b·∫°n</a>
            <a th:href="@{/home?tab=new}" class="tab-link">M·ªõi nh·∫•t</a>
            <a th:href="@{/trending}" class="tab-link active">üî• Xu H∆∞·ªõng</a>
            <a th:href="@{/ranking}" class="tab-link">üèÜ Ranking</a>
        </div>

        <div class="page-layout mt-4">
            <main class="main-content mx-auto" style="max-width: 1000px;">
                <h3 class="fw-bold mb-4">üî• T√°c ph·∫©m Xu H∆∞·ªõng (Nhi·ªÅu L∆∞·ª£t Ch·ªçn)</h3>

                <div class="ranking-grid"
                    style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">
                    <div class="rank-card" th:each="r, stat : ${trendingPosts}" style="width: 100%;">
                        <span th:class="'rank-num r' + ${stat.count}" th:text="${stat.count}">1</span>
                        <a th:href="@{/post/{id}(id=${r.id})}">
                            <img th:if="${r.imageData != null}" th:src="@{/upload/image/{id}(id=${r.id})}"
                                class="rank-img" alt="">
                            <img th:if="${r.imageData == null && r.imageUrl != null}" th:src="${r.imageUrl}"
                                class="rank-img" alt="">
                        </a>
                        <div class="rank-info">
                            <a th:href="@{/post/{id}(id=${r.id})}" class="text-decoration-none text-light">
                                <div class="rank-title" th:text="${r.title}">Ti√™u ƒë·ªÅ</div>
                            </a>
                            <a th:href="@{/profile/view/{id}(id=${r.user.id})}" class="text-decoration-none text-muted">
                                <div class="rank-author" th:text="'@' + ${r.user.username}">@user</div>
                            </a>
                        </div>
                        <span class="rank-likes"><i class="bi bi-eye-fill"></i> <span
                                th:text="${r.views}">0</span></span>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Script background -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const bgUrl = document.body.getAttribute('data-homebg');
            if (bgUrl && bgUrl.trim() !== '') {
                document.body.style.background = `url('${bgUrl}') no-repeat center center fixed`;
                document.body.style.backgroundSize = 'cover';
                document.getElementById('homeBgOverlay').style.display = 'block';
            }
        });
    </script>
</body>

</html>