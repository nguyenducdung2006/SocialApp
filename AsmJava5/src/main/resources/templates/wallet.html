<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≠ ti·ªÅn - SocialApp</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" th:href="@{/css/wallet.css}">
</head>
<body>

<nav class="top-navbar">
    <a class="brand" th:href="@{/home}">‚ú¶ SocialApp</a>
    <div class="nav-spacer"></div>
    <a th:href="@{/shop}" class="nav-btn shop-btn">
        <i class="bi bi-shop-fill me-1"></i>C·ª≠a h√†ng
    </a>
    <a th:href="@{/profile}" class="nav-btn profile-btn">
        <i class="bi bi-person-fill me-1"></i>Profile
    </a>
    <a th:href="@{/home}" class="nav-btn back-btn">
        <i class="bi bi-arrow-left me-1"></i>Trang ch·ªß
    </a>
</nav>

<div class="page-container">

    <!-- ALERTS -->
    <div th:if="${success}" class="alert-box success">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span th:text="${success}"></span>
    </div>
    <div th:if="${error}" class="alert-box error">
        <i class="bi bi-exclamation-circle-fill me-2"></i>
        <span th:text="${error}"></span>
    </div>

    <!-- BALANCE CARD -->
    <div class="balance-card">
        <div class="balance-icon">üí∞</div>
        <div class="balance-label">S·ªë d∆∞ v√≠</div>
        <div class="balance-amount"
             th:text="${#numbers.formatDecimal(user.walletBalance,0,'COMMA',0,'POINT') + 'ƒë'}">0ƒë</div>
        <div class="balance-sub">T√†i kho·∫£n: <strong th:text="${user.username}">user</strong></div>
    </div>

    <!-- RECHARGE FORM -->
    <div class="recharge-card">
        <h2 class="section-title">
            <i class="bi bi-lightning-charge-fill me-2"></i>N·∫°p ti·ªÅn
        </h2>

        <!-- Quick amounts -->
        <div class="quick-amounts">
            <button type="button" class="quick-btn" data-amount="10000">10.000ƒë</button>
            <button type="button" class="quick-btn" data-amount="20000">20.000ƒë</button>
            <button type="button" class="quick-btn" data-amount="50000">50.000ƒë</button>
            <button type="button" class="quick-btn" data-amount="100000">100.000ƒë</button>
            <button type="button" class="quick-btn" data-amount="200000">200.000ƒë</button>
            <button type="button" class="quick-btn" data-amount="500000">500.000ƒë</button>
        </div>

        <form th:action="@{/wallet/recharge}" method="post" class="recharge-form">
            <div class="input-group-wrap">
                <label class="input-label">Nh·∫≠p s·ªë ti·ªÅn mu·ªën n·∫°p</label>
                <div class="input-wrap">
                    <input type="number" name="amount" id="amountInput"
                           class="amount-input"
                           placeholder="Nh·∫≠p s·ªë ti·ªÅn..."
                           min="1000" max="10000000" required>
                    <span class="input-unit">ƒë</span>
                </div>
                <div class="input-hint">T·ªëi thi·ªÉu 1,000ƒë ‚Äî T·ªëi ƒëa 10,000,000ƒë</div>
            </div>
            <button type="submit" class="recharge-submit-btn">
                <i class="bi bi-lightning-charge-fill me-2"></i>N·∫°p ngay
            </button>
        </form>
    </div>

    <!-- TRANSACTION HISTORY -->
    <div class="history-card">
        <h2 class="section-title">
            <i class="bi bi-clock-history me-2"></i>L·ªãch s·ª≠ giao d·ªãch
        </h2>

        <div th:if="${history == null or history.empty}" class="empty-history">
            <i class="bi bi-receipt"></i>
            <p>Ch∆∞a c√≥ giao d·ªãch n√†o</p>
        </div>

        <div class="history-list" th:if="${history != null and !history.empty}">
            <div th:each="tx : ${history}"
                 class="tx-item"
                 th:classappend="${tx.transactionType == 'DEPOSIT' ? ' tx-deposit' : ' tx-purchase'}">

                <div class="tx-icon">
                    <i th:class="${tx.transactionType == 'DEPOSIT' ?
                        'bi bi-arrow-down-circle-fill' :
                        tx.transactionType == 'PURCHASE' ?
                        'bi bi-cart-check-fill' :
                        'bi bi-arrow-up-circle-fill'}"></i>
                </div>

                <div class="tx-info">
                    <div class="tx-desc" th:text="${tx.description}">M√¥ t·∫£</div>
                    <div class="tx-date"
                         th:text="${#temporals.format(tx.createdAt, 'dd/MM/yyyy HH:mm')}">Date</div>
                </div>

                <!-- ‚úÖ FIX: d√πng .signum() thay v√¨ java.math.BigDecimal.ZERO -->
                <div class="tx-amount"
                     th:classappend="${tx.amount.signum() > 0 ? ' plus' : ' minus'}"
                     th:text="${(tx.amount.signum() > 0 ? '+' : '') +
                               #numbers.formatDecimal(tx.amount,0,'COMMA',0,'POINT') + 'ƒë'}">0ƒë</div>
            </div>
        </div>
    </div>

</div>

<script th:src="@{/js/wallet.js}"></script>
</body>
</html>
